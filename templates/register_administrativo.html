{% extends "base.html" %}

{% block title %}Registrar Administrativo{% endblock %}

{% block content %}
<div class="container">
    <h2>Registrar Administrativo</h2>
    <form id="registerForm">
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username" name="username" required>

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>

        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required>

        <label for="password_confirm">Confirmar Contraseña:</label>
        <input type="password" id="password_confirm" name="password_confirm" required>

        <button type="submit">Registrar Administrativo</button>
    </form>
    <div id="error" style="color: red;"></div>
    <div id="success" style="color: green;"></div>
    <a href="/auth/home">Volver al Inicio</a>
</div>

<script>
document.getElementById('registerForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = {
        username: document.getElementById('username').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        password_confirm: document.getElementById('password_confirm').value
    };

    const token = localStorage.getItem('access_token');

    try {
        const response = await fetch('/auth/api/register/administrativo', { // <-- Cambio aquí
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}` // Enviar token
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok) {
            document.getElementById('success').innerText = 'Administrativo registrado exitosamente';
            document.getElementById('error').innerText = '';
            // Limpiar formulario si es necesario
            document.getElementById('registerForm').reset();
        } else {
            document.getElementById('error').innerText = data.msg || 'Error desconocido';
            document.getElementById('success').innerText = '';
        }
    } catch (error) {
        console.error('Error:', error);
        document.getElementById('error').innerText = 'Error de conexión';
        document.getElementById('success').innerText = '';
    }
});
</script>
{% endblock %}